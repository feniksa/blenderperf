<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elegant Report Template</title>
    <style>
        body {
            font-family: 'Georgia', serif;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            background-color: #f0f4f8;
            color: #333;
        }
        header {
            background: #3c3b6e;
            color: white;
            padding: 30px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        header h1 {
            margin: 0;
            font-size: 2.5em;
        }
        header p {
            font-size: 1.2em;
            margin: 5px 0 0;
        }
        .container {
            padding: 20px;
            width: 80%;
            margin: 20px auto;
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }
        h2, h3 {
            color: #3c3b6e;
        }
        h2 {
            border-bottom: 2px solid #3c3b6e;
            padding-bottom: 5px;
            margin-top: 30px;
        }
        .toc {
            margin: 20px 0;
        }
        .toc ul {
            list-style: none;
            padding: 0;
        }
        .toc ul li {
            margin: 10px 0;
        }
        .toc ul li a {
            text-decoration: none;
            color: #3c3b6e;
        }
        .toc ul li a:hover {
            text-decoration: underline;
        }
        .section {
            margin: 30px 0;
        }
        .chart-container {
            margin: 20px 0;
        }
        a {
            color: #3c3b6e;
        }
        .scene-image {
            text-align: center;
        }
        .scene-image img {
            height: 80%;
            width: 80%;
        }
        .chart-bar {
            margin-top: 30px;
            margin-left: 5%;
            width: 80%;
        }
    </style>
</head>
<body>
    <header>
        <h1>Blender Perf</h1>
        <p>Hip vs Cuda</p>
    </header>
    <div id="scenes" class="container">
        <div class="toc">
            <h2>Table of Scenes</h2>
            <ul id="nav-list"></ul>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.slim.min.js"></script>
    <script>
        function defaultScenes() {
            return `{
  "barbershop": [
    {
      "nodeName": "node1",
      "backendName": "HIP",
      "gpuName": "6800XT",
      "imagePath": "https://www.blender.org/wp-content/uploads/2019/07/barbershop_interior-2-480x270.png",
      "renderTime": 2.2187953838218233,
      "vramUsage": 10.28798908581921,
      "perfettoTracePath": "https://www.blender.org/wp-content/uploads/2019/07/barbershop_interior-2-480x270.png"
    },
    {
      "nodeName": "node1",
      "backendName": "CUDA",
      "gpuName": "RTX 3080",
      "imagePath": "https://www.blender.org/wp-content/uploads/2019/07/barbershop_interior-2-480x270.png",
      "renderTime": 1.8813293848889394,
      "vramUsage": 8.770570907726071,
      "perfettoTracePath": "https://www.blender.org/wp-content/uploads/2019/07/barbershop_interior-2-480x270.png"
    },
    {
      "nodeName": "node1",
      "backendName": "HIP",
      "gpuName": "RTX 3080",
      "imagePath": "https://www.blender.org/wp-content/uploads/2019/07/barbershop_interior-2-480x270.png",
      "renderTime": 2.4473990080254815,
      "vramUsage": 11.029429865991176,
      "perfettoTracePath": "https://www.blender.org/wp-content/uploads/2019/07/barbershop_interior-2-480x270.png"
    },
    {
      "nodeName": "node2",
      "backendName": "HIP",
      "gpuName": "6800XT",
      "imagePath": "https://www.blender.org/wp-content/uploads/2019/07/barbershop_interior-2-480x270.png",
      "renderTime": 1.7136027524919415,
      "vramUsage": 10.560999178171347,
      "perfettoTracePath": "https://www.blender.org/wp-content/uploads/2019/07/barbershop_interior-2-480x270.png"
    },
    {
      "nodeName": "node2",
      "backendName": "CUDA",
      "gpuName": "RTX 3080",
      "imagePath": "https://www.blender.org/wp-content/uploads/2019/07/barbershop_interior-2-480x270.png",
      "renderTime": 1.9814017056140827,
      "vramUsage": 10.209807601965387,
      "perfettoTracePath": "https://www.blender.org/wp-content/uploads/2019/07/barbershop_interior-2-480x270.png"
    },
    {
      "nodeName": "node2",
      "backendName": "HIP",
      "gpuName": "RTX 3080",
      "imagePath": "https://www.blender.org/wp-content/uploads/2019/07/barbershop_interior-2-480x270.png",
      "renderTime": 1.9963880629471378,
      "vramUsage": 8.53666134738229,
      "perfettoTracePath": "https://www.blender.org/wp-content/uploads/2019/07/barbershop_interior-2-480x270.png"
    }
  ],
  "cube": [
    {
      "nodeName": "node1",
      "backendName": "HIP",
      "gpuName": "6800XT",
      "imagePath": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQYUIRZpKdk6Y68o_ABJH8JfclIX-ppVid9jg&s",
      "renderTime": 0.7836650446336921,
      "vramUsage": 5.970275765846175,
      "perfettoTracePath": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQYUIRZpKdk6Y68o_ABJH8JfclIX-ppVid9jg&s"
    },
    {
      "nodeName": "node1",
      "backendName": "CUDA",
      "gpuName": "RTX 3080",
      "imagePath": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQYUIRZpKdk6Y68o_ABJH8JfclIX-ppVid9jg&s",
      "renderTime": 0.5151762538999167,
      "vramUsage": 7.00608499172403,
      "perfettoTracePath": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQYUIRZpKdk6Y68o_ABJH8JfclIX-ppVid9jg&s"
    },
    {
      "nodeName": "node1",
      "backendName": "HIP",
      "gpuName": "RTX 3080",
      "imagePath": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQYUIRZpKdk6Y68o_ABJH8JfclIX-ppVid9jg&s",
      "renderTime": 1.3463660218926623,
      "vramUsage": 3.3296263186361608,
      "perfettoTracePath": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQYUIRZpKdk6Y68o_ABJH8JfclIX-ppVid9jg&s"
    },
    {
      "nodeName": "node2",
      "backendName": "HIP",
      "gpuName": "6800XT",
      "imagePath": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQYUIRZpKdk6Y68o_ABJH8JfclIX-ppVid9jg&s",
      "renderTime": 0.6905337183643405,
      "vramUsage": 3.087953296814198,
      "perfettoTracePath": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQYUIRZpKdk6Y68o_ABJH8JfclIX-ppVid9jg&s"
    },
    {
      "nodeName": "node2",
      "backendName": "CUDA",
      "gpuName": "RTX 3080",
      "imagePath": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQYUIRZpKdk6Y68o_ABJH8JfclIX-ppVid9jg&s",
      "renderTime": 0.5750761972331693,
      "vramUsage": 4.655203846554964,
      "perfettoTracePath": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQYUIRZpKdk6Y68o_ABJH8JfclIX-ppVid9jg&s"
    },
    {
      "nodeName": "node2",
      "backendName": "HIP",
      "gpuName": "RTX 3080",
      "imagePath": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQYUIRZpKdk6Y68o_ABJH8JfclIX-ppVid9jg&s",
      "renderTime": 0.9496619518521427,
      "vramUsage": 4.264481778591014,
      "perfettoTracePath": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQYUIRZpKdk6Y68o_ABJH8JfclIX-ppVid9jg&s"
    }
  ],
  "triangle": [
    {
      "nodeName": "node1",
      "backendName": "HIP",
      "gpuName": "6800XT",
      "imagePath": "https://i.sstatic.net/Np675.png",
      "renderTime": 1.6323021861740519,
      "vramUsage": 9.901299002510914,
      "perfettoTracePath": "https://i.sstatic.net/Np675.png"
    },
    {
      "nodeName": "node1",
      "backendName": "CUDA",
      "gpuName": "RTX 3080",
      "imagePath": "https://i.sstatic.net/Np675.png",
      "renderTime": 1.9689239582341789,
      "vramUsage": 12.097155476111856,
      "perfettoTracePath": "https://i.sstatic.net/Np675.png"
    },
    {
      "nodeName": "node1",
      "backendName": "HIP",
      "gpuName": "RTX 3080",
      "imagePath": "https://i.sstatic.net/Np675.png",
      "renderTime": 2.1718440481499535,
      "vramUsage": 10.015121335589265,
      "perfettoTracePath": "https://i.sstatic.net/Np675.png"
    },
    {
      "nodeName": "node2",
      "backendName": "HIP",
      "gpuName": "6800XT",
      "imagePath": "https://i.sstatic.net/Np675.png",
      "renderTime": 1.5703145240240675,
      "vramUsage": 8.391312083072556,
      "perfettoTracePath": "https://i.sstatic.net/Np675.png"
    },
    {
      "nodeName": "node2",
      "backendName": "CUDA",
      "gpuName": "RTX 3080",
      "imagePath": "https://i.sstatic.net/Np675.png",
      "renderTime": 2.059075575016358,
      "vramUsage": 7.6174794401978225,
      "perfettoTracePath": "https://i.sstatic.net/Np675.png"
    },
    {
      "nodeName": "node2",
      "backendName": "HIP",
      "gpuName": "RTX 3080",
      "imagePath": "https://i.sstatic.net/Np675.png",
      "renderTime": 1.5607989623859666,
      "vramUsage": 8.411200819700891,
      "perfettoTracePath": "https://i.sstatic.net/Np675.png"
    }
  ],
  "suzanne": [
    {
      "nodeName": "node1",
      "backendName": "HIP",
      "gpuName": "6800XT",
      "imagePath": "https://www.dummies.com/wp-content/uploads/479857.image0.jpg",
      "renderTime": 2.411544758483326,
      "vramUsage": 10.779598487985755,
      "perfettoTracePath": "https://www.dummies.com/wp-content/uploads/479857.image0.jpg"
    },
    {
      "nodeName": "node1",
      "backendName": "CUDA",
      "gpuName": "RTX 3080",
      "imagePath": "https://www.dummies.com/wp-content/uploads/479857.image0.jpg",
      "renderTime": 2.4447987753044567,
      "vramUsage": 11.395192394359906,
      "perfettoTracePath": "https://www.dummies.com/wp-content/uploads/479857.image0.jpg"
    },
    {
      "nodeName": "node1",
      "backendName": "HIP",
      "gpuName": "RTX 3080",
      "imagePath": "https://www.dummies.com/wp-content/uploads/479857.image0.jpg",
      "renderTime": 1.9075254397228196,
      "vramUsage": 10.676125201057346,
      "perfettoTracePath": "https://www.dummies.com/wp-content/uploads/479857.image0.jpg"
    },
    {
      "nodeName": "node2",
      "backendName": "HIP",
      "gpuName": "6800XT",
      "imagePath": "https://www.dummies.com/wp-content/uploads/479857.image0.jpg",
      "renderTime": 1.9727729782769874,
      "vramUsage": 12.17053093426604,
      "perfettoTracePath": "https://www.dummies.com/wp-content/uploads/479857.image0.jpg"
    },
    {
      "nodeName": "node2",
      "backendName": "CUDA",
      "gpuName": "RTX 3080",
      "imagePath": "https://www.dummies.com/wp-content/uploads/479857.image0.jpg",
      "renderTime": 2.3359464916095565,
      "vramUsage": 11.074428361196587,
      "perfettoTracePath": "https://www.dummies.com/wp-content/uploads/479857.image0.jpg"
    },
    {
      "nodeName": "node2",
      "backendName": "HIP",
      "gpuName": "RTX 3080",
      "imagePath": "https://www.dummies.com/wp-content/uploads/479857.image0.jpg",
      "renderTime": 1.5603041703094114,
      "vramUsage": 9.524028589987278,
      "perfettoTracePath": "https://www.dummies.com/wp-content/uploads/479857.image0.jpg"
    }
  ]
}`;
        }
        function createChartBar(canvasElemId, label, data) {
            const isCuda = backendName => backendName.toLowerCase() == "cuda";

            const canvasElem = $(`<canvas id="${canvasElemId}"></canvas>`);
            const divElem = $(`<div class="chart-bar"></div>`);
            divElem.height(`${data.length * 75}px`);
            divElem.append(canvasElem);
            
            const chartBar = new Chart(canvasElem, {
                type: "bar",
                data: {
                    labels: data.map(x => x.name),
                    datasets: [
                        {
                            label: label,
                            data: data.map(x => x.value),
                            borderWidth: 1,
                            backgroundColor:  data
                                .map(x => isCuda(x.backendName) ? "rgba(114, 178, 6, 0.3)" : "rgba(241, 75, 82, 0.3)"),
                            borderColor: data
                                .map(x => isCuda(x.backendName) ? "rgb(114, 178, 6)" : "rgb(241, 75, 82)"),
                        },
                    ]
                },
                options: {
                    indexAxis: "y",
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            return {
                divElem,
                chartBar,
            };
        }

        const scenes = JSON.parse(defaultScenes());

        const divScenes = $("#scenes");
        const ulNavList = $("#nav-list");
        let i = 0;
        for (const sceneName of Object.keys(scenes).sort()) {
            // cannot use scene name as id because it may contain spaces
            const divId = `scene-${i}`;
            const sceneData = scenes[sceneName];
            const perfettoTracePath = (sceneData.find(x => "perfettoTracePath" in x) ?? {}).perfettoTracePath;
            const sceneDataPath = (sceneData.find(x => "sceneDataPath" in x) ?? {}).sceneDataPath;

            ulNavList.append(`<li><a href="#${divId}">${sceneName}</a></li>`);
            const divScene = divScenes.append(`<div id="${divId}" class="section"></div>`);
            divScene.append(`<h2>${sceneName}</h2>`);
            divScene.append(`<div class="scene-image">
                <img src="${sceneData[0].imagePath}" alt="${sceneName}" />
                <a href="${perfettoTracePath}"><h3>Perfetto trace</h3></a>
                <a href="${sceneDataPath}">Scene data</h3></a>
            </div>`);

            const renderTimeChart = createChartBar(
                `scene-${i}-renderTime`, 
                "Render Time (in Seconds)", 
                sceneData
                    .map(x => ({ name: `${x.backendName} / ${x.gpuName} (${x.nodeName})`, value: x.renderTime, backendName: x.backendName }))
                    .sort((a, b) => a.value - b.value)
            );
            divScene.append(renderTimeChart.divElem);
            
            const vramUsageChart = createChartBar(
                `scene-${i}-vramUsage`, 
                "Memory Usage (in GB)", 
                sceneData
                    .map(x => ({ name: `${x.backendName} / ${x.gpuName} (${x.nodeName})`, value: x.vramUsage, backendName: x.backendName }))
                    .sort((a, b) => a.value - b.value)
            );
            divScene.append(vramUsageChart.divElem);
            i++;
        }
    </script>
</body>
</html>
